import{T as e,e as t,a as r}from"./core-6rZeXUyU.js";import{notify as n}from"./error-08r2a_lb.js";const o=[...e.keys()].map((e=>`script[type="${e}"][terminal],${e}-script[terminal]`)).join(","),i=e=>{throw n(e),new Error(e)},a=async()=>{const e=document.querySelectorAll(o);if(!e.length)return;s.disconnect(),e.length>1&&i("You can use at most 1 terminal.");const[n]=e;n.matches('script[type="mpy"],mpy-script')&&i("Unsupported terminal."),document.head.append(Object.assign(document.createElement("link"),{rel:"stylesheet",href:new URL("./xterm.css",import.meta.url)}));const[{Terminal:a},{Readline:d},{FitAddon:l}]=await Promise.all([import("./xterm-f2QfYNGL.js"),import("./xterm-readline-ONk85xtH.js"),import("./xterm_addon-fit-E4yMPZTX.js")]),c=new d,m=e=>{let t=n;const o=n.getAttribute("target");if(o){if(t=document.getElementById(o)||document.querySelector(o),!t)throw new Error(`Unknown target ${o}`)}else t=document.createElement("py-terminal"),t.style.display="block",n.after(t);const i=new a({theme:{background:"#191A19",foreground:"#F5F2E7"},...e}),s=new l;i.loadAddon(s),i.loadAddon(c),i.open(t),s.fit(),i.focus(),r(n,"terminal",{value:i})};if(n.hasAttribute("worker")){const e=({interpreter:e},{sync:t})=>{t.pyterminal_drop_hooks();const r=new TextDecoder;let n="";const o={isatty:!0,write:e=>(n=r.decode(e),t.pyterminal_write(n),e.length)};e.setStdout(o),e.setStderr(o),e.setStdin({isatty:!0,stdin:()=>t.pyterminal_read(n)})};t.main.onWorker.add((function r(n,o){t.main.onWorker.delete(r),m({disableStdin:!1,cursorBlink:!0,cursorStyle:"block"}),o.sync.pyterminal_read=c.read.bind(c),o.sync.pyterminal_write=c.write.bind(c),o.sync.pyterminal_drop_hooks=()=>{t.worker.onReady.delete(e)}})),t.worker.onReady.add(e)}else t.main.onReady.add((function e({io:r}){console.warn("py-terminal is read only on main thread"),t.main.onReady.delete(e),m({disableStdin:!0,cursorBlink:!1,cursorStyle:"underline"}),r.stdout=e=>{c.write(`${e}\n`)},r.stderr=e=>{c.write(`${e.message||e}\n`)}}))},s=new MutationObserver(a);s.observe(document,{childList:!0,subtree:!0});var d=a();export{d as default};
//# sourceMappingURL=py-terminal-CpWO5MXf.js.map
